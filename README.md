# Transculturalist

A platform for cultural learning through interactive AI-powered games. Experience different cultures through engaging roleplay, stories, quizzes, and matching games generated by advanced AI models.

## Features

- **Interactive Games**: Multiple game types including roleplay, story generation, multiple-choice questions, and matching games
- **AI-Powered Content**: Dynamic content generation using OpenAI's GPT models
- **Cultural Learning**: Explore various cultural themes and traditions
- **Multi-language Support**: Built-in internationalization (i18n) system
- **User Authentication**: Optional Supabase-based authentication system
- **Forum System**: Community discussion with AI-powered responses
- **Leaderboard**: Global and user-specific ranking system
- **Guest Mode**: Play without registration with local storage
- **Web-Based Interface**: Simple and intuitive responsive interface
- **Docker Support**: Easy deployment with Docker Compose
- **Database Flexibility**: Support for both SQLite and PostgreSQL

## Game Types

- **Roleplay**: Engage in conversations with AI characters from different cultures
- **Story**: Experience interactive cultural stories with branching narratives
- **MCQ (Multiple Choice Questions)**: Test your knowledge with culturally-themed quizzes
- **Matching**: Match cultural elements and concepts

## Tech Stack

- **Backend**: Node.js with Express.js
- **Database**: SQLite (with PostgreSQL support)
- **Frontend**: Vanilla HTML/CSS/JavaScript with i18n support
- **AI Integration**: OpenAI API
- **Authentication**: Optional multi-user authentication
- **Containerization**: Docker & Docker Compose


## Prerequisites

- Node.js (v14 or higher)
- Docker & Docker Compose (for containerized deployment)
- OpenAI API key

## Configuration

All configuration is managed in `server/config.js`. You can copy and edit `server/config.example.js` as a template:

```
cp server/config.example.js server/config.js
```

Edit `server/config.js` and fill in your keys:

```javascript
module.exports = {
   OPENAI_API_KEY: 'your-openai-api-key-here',
   BASE_URL: 'https://api.openai.com/v1',
   DEFAULT_MODEL: 'gpt-4o-mini',
   PORT: 3030, // Server port
   ENABLE_AUTH: false, // Set to true to enable Supabase 
};
```

## Installation

### Option 1: Using Docker (Recommended)

#### 1.1 Using Pre-built Docker Image (Easiest)

You can run the application in any folder you like. You do NOT need to clone the whole repository—just prepare the following files:

1. **Configure your settings**: See the [Configuration](#configuration) section above to create and edit your `config.js` file.

2. In your folder, run one of the following commands (use an absolute path or `${PWD}` for config.js):

   **Option A: Using `${PWD}` (recommended for PowerShell):**
   ```powershell
   docker run -d --name transculturalist_app -p 3030:3030 -v ${PWD}/config.js:/app/server/config.js:ro -v ${PWD}/data:/app/server/data -v ${PWD}/uploads:/app/uploads -e NODE_ENV=production ghcr.io/bylinmou/transculturalist:latest
   ```

   **Option B: Using absolute path (replace with your actual folder path):**
   ```powershell
   docker run -d --name transculturalist_app -p 3030:3030 -v C:/Users/YourName/YourFolder/config.js:/app/server/config.js:ro -v C:/Users/YourName/YourFolder/data:/app/server/data -v C:/Users/YourName/YourFolder/uploads:/app/uploads -e NODE_ENV=production ghcr.io/bylinmou/transculturalist:latest
   ```

The application will be available at `http://localhost:3030`

**Note:**
- Always use an absolute path or `${PWD}` for the left side of the `-v` option to avoid Docker mount errors, especially on Windows.

#### 1.2 Building from Source

If you prefer to build the image locally:

1. Clone the repository:
   ```bash
   git clone https://github.com/BYLinMou/Transculturalist.git
   cd Transculturalist
   ```

2. **Configure your settings**: See the [Configuration](#configuration) section above to create and edit your `config.js` file.

3. Build and run the application:
   ```bash
   docker compose up --build
   ```

The application will be available at `http://localhost:3030`


### Option 2: Using Node.js

1. Clone the repository:
   ```bash
   git clone https://github.com/BYLinMou/Transculturalist.git
   cd Transculturalist
   ```

2. Install dependencies:
   ```bash
   # Frontend dependencies (if any)
   cd frontend
   npm install
   cd ..

   # Backend dependencies
   cd server
   npm install
   cd ..
   ```

3. **Configure your settings**: See the [Configuration](#configuration) section above to create and edit your `config.js` file.

4. Build the frontend:
   ```bash
   cd frontend
   npm run build
   cd ..
   ```

5. Start the server:
   ```bash
   cd server
   npm run dev  # For development with auto-reload
   # or
   npm start    # For production
   ```

6. Open your browser and navigate to `http://localhost:3030`

## Development

### Project Structure

```
Transculturalist/
├── frontend/                      # Frontend workspace
│   ├── public/                    # Static files served to clients
│   │   ├── assets/                # Shared frontend assets
│   │   │   ├── js/                # Core JavaScript modules
│   │   │   ├── locales/           # Translation files
│   │   │   └── styles.css         # Global styles
│   │   ├── components/            # Reusable UI components
│   │   ├── game/                  # Game pages
│   │   ├── forum/                 # Forum pages
│   │   ├── index.html             # Main entry page
│   │   ├── culture-selection.html # Culture selection page
│   │   ├── settings.html          # User settings page
│   │   └── privacy-policy.html    # Privacy policy
│   ├── dist/                      # Built files
│   ├── build.js                   # Build script
│   └── package.json               # Frontend dependencies
├── server/                        # Backend workspace
│   ├── src/
│   │   ├── routes/                # API route handlers
│   │   ├── services/              # shared utilites
│   │   ├── middleware/            # Express middleware
│   │   ├── db/                    # Database layer
│   │   ├── shared/                # Shared utilities
│   │   └── index.js               # Server entry point
│   ├── config/                    # Configuration files
│   │   ├── games/                 # Game type configurations
│   │   └── stats-config.js        # Statistics configuration
│   ├── db/                        # Database initialization scripts
│   ├── data/                      # SQLite database files (generated)
│   ├── uploads/                   # User uploaded files
│   ├── config.js                  # Main configuration (user-created)
│   ├── config.example.js          # Configuration template
│   ├── Dockerfile                 # Docker build instructions
│   └── package.json               # Backend dependencies
├── docker-compose.yml             # Docker Compose configuration
└── package.json                   # Root workspace configuration
```

### Key Components

#### Backend Architecture
- **Modular Routes**: API endpoints organized by feature (auth, games, forum, etc.)
- **Database Abstraction**: Support for both SQLite (primary) and PostgreSQL
- **Service Layer**: Business logic separated from routes
- **Middleware**: Authentication and request validation
- **AI Integration**: OpenAI API for content generation

#### Frontend Architecture
- **Component-Based**: Reusable HTML components
- **Internationalization**: Multi-language support (i18n)
- **Guest Mode**: Local storage for unauthenticated users
- **API Communication**: Centralized API helper
- **Authentication**: Optional user registration and login

#### Database Schema
- **Users**: User accounts and profiles
- **Game Sessions**: Game progress tracking
- **Leaderboard**: Global and user-specific rankings
- **Forum**: Posts, comments, votes, and rankings
- **Statistics**: User statistics and achievements

### Adding New Games

1. Create a new game configuration in `server/config/games/` (JSON format)
2. Update the game service in `server/src/services/gameConfigService.js`
3. Add corresponding frontend game page in `frontend/public/game/`
4. Add game-specific JavaScript logic in `frontend/public/assets/js/`
5. Update translations in `frontend/public/assets/locales/`

### Adding New API Routes

1. Create a new module in `server/src/routes/modules/`
2. Import and register in `server/src/routes/api.js`
3. Use middleware from `server/src/middleware/` for authentication if needed

### Database Management

The application uses an automatic database initialization system:
- SQLite: Database is created automatically in `server/data/`
- PostgreSQL: Use `server/db/init.common.sql` and `server/db/init.forum.postgres.sql`
- Schema is initialized on first startup
- Database type is automatically detected from configuration

## API Endpoints

### General
- `GET /api/health` - Health check
- `GET /api/languages` - Get supported languages

### Games
- `GET /api/games` - List available games
- `POST /api/ai/generate` - Generate game content
- `POST /api/roleplay/character` - Generate roleplay character
- `POST /api/roleplay/chat` - Continue roleplay conversation
- `POST /api/story/chapter` - Generate story chapter

### Authentication (if enabled)
- `POST /api/auth/register` - User registration
- `POST /api/auth/login` - User login
- `GET /api/auth/logout` - User logout
- `GET /api/auth/user` - Get current user info

### User & Leaderboard
- `GET /api/user/stats` - Get user statistics
- `GET /api/leaderboard` - Get global leaderboard
- `GET /api/leaderboard/user` - Get user-specific leaderboard data

### Forum
- `GET /api/forum/posts` - List forum posts
- `POST /api/forum/posts` - Create new forum post
- `GET /api/forum/posts/:id` - Get specific post
- `POST /api/forum/posts/:id/comments` - Add comment to post
- `POST /api/forum/posts/:id/vote` - Vote on post
- `POST /api/forum/ai/generate-response` - AI-generated forum responses
- `GET /api/forum/ranking` - Get forum user rankings

### Upload
- `POST /api/upload` - File upload for forum attachments

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Test thoroughly
5. Submit a pull request

## License

This project is licensed under the GNU General Public License v3.0 - see the [LICENSE](LICENSE) file for details.